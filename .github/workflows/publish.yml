name: Збірка та Публікація Python-пакету на PyPI

on:
  # Запускається при пуші в гілку main
  push:
    branches:
      - main
  # Дозволяє ручний запуск
  workflow_dispatch:

jobs:
  build-and-publish:
    runs-on: ubuntu-latest

    # Рекомендується для сучасних GitHub Actions
    permissions:
      id-token: write
      contents: read

    steps:
      # 1. Клонуємо репозиторій
      - name: Перевірка репозиторію
        uses: actions/checkout@v4

      # 2. Встановлюємо Python
      - name: Налаштування Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # Використовуємо останню стабільну 3.x версію

      # --- Docker-частина (залишаємо як було) ---

      # 3. Будуємо Docker-імідж
      - name: Збірка Docker-іміджу
        run: docker build -t my-tail:latest .

      # 4. Тестуємо Docker-імідж (опційно)
      - name: Тест Docker-іміджу
        run: docker run --rm my-tail --help

      # --- PyPI-частина: Збірка та Публікація ---

      # 5. Встановлюємо інструменти та збираємо пакет
      # Це необхідний крок для створення дистрибутивів (wheels та sdist)
      - name: Збірка Python-пакету
        run: |
          pip install build
          python -m build

      # 6. Публікуємо на ОФІЦІЙНИЙ PyPI
      - name: Публікація на PyPI
        uses: pypa/gh-action-pypi-publish@release/v1
        with:
          # Цей action автоматично знаходить файли у dist/
          # і використовує PyPI як репозиторій за замовчуванням.
          # Використовуємо ваш секретний токен для автентифікації.
          password: ${{ secrets.PYPI_API_TOKEN }}